# AGENT.md

このリポジトリで開発を行うエージェント（GitHub Copilot や将来の人間開発者）向けのガイドです。  
プロジェクトの目的・方針・開発ルールをここにまとめます。

---

## プロジェクトの目的

幼稚園の「絵本読み聞かせ」活動を支援する LINE ミニアプリ＋管理 Web アプリを開発する。

- 保護者は LINE ミニアプリから参加アンケートに回答できる
- 管理者は Web 画面からアンケート結果を確認し、確定日程・参加者を登録できる
- 個人に紐づくデータは年度単位で完結させる
- 絵本（ISBN ベース）の履歴は長期的に残し、次の絵本選びに活用する

詳細は以下を参照：
- `README.md`
- `RequirementSpecification.md`
- `ArchitectureDesign.md`
- `Milestone.md`

---

## 開発方針

### 1. TDD（テスト駆動開発）を基本とする

- 可能な限り **テストを先に書く**（または少なくとも同じ PR 内で追加する）
- 新しい機能を追加するときは、以下の順番を推奨：
  1. 期待する振る舞いをテストで表現する
  2. 最小限の実装でテストを通す
  3. リファクタリングする（テストはグリーンのまま）
- バグ修正時も、再現テスト → 修正 → テストグリーン、の流れを守る

### 2. 小さな変更・小さな PR

- 1 つの PR / 1 つのコミットで解決する Issue は **できるだけ小さく**する
- Copilot やエージェントは、一気に大規模な変更を提案するのではなく、
  - 1 つの画面
  - 1 つの API
  - 1 つのテーブル
  など、単位を絞ってコードを生成することを推奨

### 3. 読みやすさ優先

- ロジックが複雑になる場合は、名前付きの関数やドメインサービスに切り出す
- コメントは「なぜそうしているか」を書く  
  （「何をしているか」はコードと型で読み取れる状態が理想）

---

## 技術スタックの方針

※実装時に多少変えてもよいが、その場合は AGENT.md を更新すること。

- 言語: TypeScript
- フロントエンド:
  - 管理画面: Next.js（React + TypeScript）
  - LIFF ミニアプリ: Next.js 内に `/liff` 的なエントリを持たせる方針
- バックエンド:
  - Next.js の API Routes または独立した Node.js + Express/Fastify
  - 当面はモノリポ構成（1つのリポジトリに全部入れる）
- DB:
  - PostgreSQL を想定
  - Prisma を ORマッパ／マイグレーションツールとして使用予定
- テスト:
  - 単体テスト: Jest または Vitest（どちらかに決定）
  - フロントエンドコンポーネント: Testing Library
  - API 層: Supertest（または Next.js のテストユーティリティ）

---

## テストポリシー

- `src/**/__tests__/**/*.test.ts` もしくは `*.spec.ts` 形式でテストを書く
- CI では最低限以下を実行する：
  - `npm run lint`
  - `npm run test`
  - `npm run build`（将来追加）

### テストを書く優先度

1. ドメインロジック（集計・フィルタ・バリデーション）
2. API レイヤー（リクエスト/レスポンスの形）
3. フロントエンド（重要な画面の基本フロー）

UI の細かい見た目よりも、「正しいデータが扱われるか」を優先してテストする。

---

## CI / CD 方針

- GitHub Actions を用いた CI を使用する
- `main` / `develop` ブランチ（運用方針により決める）への PR は、以下がすべて通ること：
  - Lint
  - Test
  - Build
- 今のところ自動デプロイ（CD）は必須ではないが、将来的に追加しやすい構成を目指す

---

## コーディング規約

- フォーマッタ: Prettier
- Lint: ESLint（TypeScript 推奨設定＋React ルール）
- import順などは ESLint + Prettier に従う
- 命名規則:
  - TypeScript: `camelCase`
  - React コンポーネント / クラス: `PascalCase`
  - 定数: `UPPER_SNAKE_CASE`（必要な場合）

---

## Copilot / 自動エージェント向けガイドライン

- このファイルと `RequirementSpecification.md` を優先的に参照し、  
  「何をやっているリポジトリか」「どこまでがスコープか」を理解した上でコードを生成すること
- 一度に大量のファイルを変更しないこと（レビューしづらくなる）
- 型定義（TypeScript）を積極的に利用し、`any` を極力避ける
- 迷った場合は、ドメイン知識に近いロジックを先にテストで表現する

---

## ブランチ運用（暫定）

- `main`: 動くものだけが入るブランチ（本番相当）
- `develop`（必要なら）: 開発用メインブランチ
- Feature ブランチ:
  - 名前例: `feature/survey-list`, `feature/liff-profile`
- バグ修正:
  - 名前例: `fix/survey-csv-export`

ブランチ運用ルールを変えた場合は、ここを更新すること。

---

## TODO（この AGENT.md 自体の今後）

- 実際にスタックが決まったら、テストツールやコマンド名を具体化する
- CI 設定（GitHub Actions）と連動する形で、コマンド名を揃える
- コントリビュート規約（CONTRIBUTING.md）が必要になったら分離する
